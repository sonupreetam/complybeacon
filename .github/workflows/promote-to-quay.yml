---
# Promote to Quay Workflow - TEST VERSION

name: Promote to Quay

on:
  push:
    tags: ['v*.*.*']
  workflow_dispatch:
    inputs:
      source_sha:
        description: 'Source commit SHA to promote (defaults to tag commit)'
        required: false
        type: string

permissions:
  packages: none
  id-token: none

concurrency:
  group: promote-to-quay-${{ github.ref }}
  cancel-in-progress: false

jobs:
  promote-compass:
    permissions:
      packages: read
    uses: complytime/org-infra/.github/workflows/reusable_promote.yml@main
    with:
      source_registry: ghcr.io
      source_image: sonupreetam/test-compass
      source_tag: sha-${{ inputs.source_sha || github.sha }}
      dest_registry: quay.io
      dest_image: spreetam/test-compass-from-fork
      dest_tag: test-${{ github.run_number }}
      create_semver_tags: false
      verify_source_signature: false
      allowed_identity_regex: https://github.com/complytime/org-infra(/.*)?
    secrets:
      dest_username: ${{ secrets.QUAY_USERNAME }}
      dest_password: ${{ secrets.QUAY_PASSWORD }}
